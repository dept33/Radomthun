<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600&display=swap");
      body {
        font-family: "Kanit", sans-serif;
        background: #050810;
        color: #cbd5e1;
      }

      .glass-card {
        background: rgba(30, 41, 59, 0.4);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .sidebar-link {
        transition: all 0.3s;
        border-right: 3px solid transparent;
      }
      .sidebar-link.active,
      .sidebar-link:hover {
        background: rgba(59, 130, 246, 0.1);
        color: #60a5fa;
        border-right-color: #3b82f6;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 5px;
        height: 5px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #0f172a;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 5px;
      }
    </style>
  </head>
  <body class="h-screen flex overflow-hidden">
    <aside
      class="w-64 bg-slate-900/50 border-r border-white/5 flex flex-col hidden md:flex"
    >
      <div class="p-6">
        <h1 class="text-xl font-bold text-white tracking-wider">
          <i class="fas fa-shield-alt text-blue-500 mr-2"></i>ADMIN
        </h1>
        <p class="text-[10px] text-slate-500 uppercase mt-1">
          System Control v2.0
        </p>
      </div>

      <nav class="flex-1 space-y-1 px-3">
        <a
          href="#"
          onclick="showSection('dashboard')"
          id="nav-dashboard"
          class="sidebar-link active flex items-center px-4 py-3 text-sm font-medium rounded-lg"
        >
          <i class="fas fa-chart-pie w-6"></i> ภาพรวมระบบ
        </a>
        <a
          href="#"
          onclick="showSection('donations')"
          id="nav-donations"
          class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-lg"
        >
          <i class="fas fa-file-invoice-dollar w-6"></i> รายการเงินเข้า
        </a>
        <a
          href="#"
          onclick="showSection('hardware')"
          id="nav-hardware"
          class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-lg"
        >
          <i class="fas fa-microchip w-6"></i> คลังอุปกรณ์
        </a>
        <a
          href="#"
          onclick="showSection('settings')"
          id="nav-settings"
          class="sidebar-link flex items-center px-4 py-3 text-sm font-medium rounded-lg"
        >
          <i class="fas fa-sliders-h w-6"></i> ตั้งค่าบัญชีรับเงิน
        </a>
      </nav>

      <div class="p-4 border-t border-white/5">
        <a
          href="index.html"
          class="flex items-center px-4 py-2 text-sm text-red-400 hover:text-white hover:bg-red-500/10 rounded-lg transition-colors"
        >
          <i class="fas fa-sign-out-alt w-6"></i> ออกจากระบบ
        </a>
      </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
      <header
        class="md:hidden bg-slate-900 border-b border-white/5 p-4 flex justify-between items-center z-20"
      >
        <span class="font-bold">ADMIN PANEL</span>
        <button
          onclick="
            document.querySelector('aside').classList.toggle('hidden');
            document
              .querySelector('aside')
              .classList.add('absolute', 'z-50', 'h-full', 'bg-slate-900');
          "
          class="text-white"
        >
          <i class="fas fa-bars"></i>
        </button>
      </header>

      <div
        class="flex-1 overflow-y-auto custom-scrollbar p-4 md:p-8 space-y-8"
        id="content-area"
      >
        <div id="sec-dashboard" class="space-y-6 animate-fade">
          <h2 class="text-2xl font-bold text-white mb-6">Dashboard Overview</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass-card p-6 rounded-2xl relative overflow-hidden">
              <div
                class="absolute -right-4 -top-4 w-24 h-24 bg-blue-500/10 rounded-full blur-xl"
              ></div>
              <p class="text-xs text-slate-400 uppercase tracking-widest">
                ยอดเงินบริจาคสะสม
              </p>
              <h3
                class="text-4xl font-black text-white mt-2"
                id="dash-total-money"
              >
                ฿0
              </h3>
              <p class="text-xs text-emerald-400 mt-2 flex items-center gap-1">
                <i class="fas fa-arrow-up"></i> Updated just now
              </p>
            </div>
            <div class="glass-card p-6 rounded-2xl">
              <p class="text-xs text-slate-400 uppercase tracking-widest">
                รายการรอตรวจสอบ
              </p>
              <h3
                class="text-4xl font-black text-orange-400 mt-2"
                id="dash-pending"
              >
                0
              </h3>
              <p class="text-xs text-slate-500 mt-2">Requires Action</p>
            </div>
            <div class="glass-card p-6 rounded-2xl">
              <p class="text-xs text-slate-400 uppercase tracking-widest">
                จำนวนอุปกรณ์
              </p>
              <h3
                class="text-4xl font-black text-purple-400 mt-2"
                id="dash-hardware"
              >
                0
              </h3>
              <p class="text-xs text-slate-500 mt-2">Items in stock</p>
            </div>
          </div>

          <div class="glass-card rounded-2xl p-6">
            <h3 class="font-bold text-white mb-4">กิจกรรมล่าสุด</h3>
            <div
              id="activity-logs"
              class="space-y-3 text-sm text-slate-400"
            ></div>
          </div>
        </div>

        <div id="sec-donations" class="hidden space-y-6 animate-fade">
          <div class="flex justify-between items-end">
            <h2 class="text-2xl font-bold text-white">รายการเงินบริจาค</h2>
            <button
              onclick="clearData('logs')"
              class="text-xs text-red-500 hover:text-red-400"
            >
              <i class="fas fa-trash-alt mr-1"></i> ล้างประวัติ
            </button>
          </div>
          <div class="glass-card rounded-2xl overflow-hidden">
            <table class="w-full text-left text-sm">
              <thead
                class="bg-black/20 text-slate-400 uppercase text-[10px] tracking-wider"
              >
                <tr>
                  <th class="p-4">เวลา</th>
                  <th class="p-4">ผู้บริจาค</th>
                  <th class="p-4">ยอดเงิน</th>
                  <th class="p-4 text-center">หลักฐาน</th>
                  <th class="p-4 text-center">จัดการ</th>
                </tr>
              </thead>
              <tbody id="table-money" class="divide-y divide-white/5"></tbody>
            </table>
          </div>
        </div>

        <div id="sec-hardware" class="hidden space-y-6 animate-fade">
          <h2 class="text-2xl font-bold text-white">รายการบริจาคอุปกรณ์</h2>
          <div class="glass-card rounded-2xl overflow-hidden">
            <table class="w-full text-left text-sm">
              <thead
                class="bg-black/20 text-slate-400 uppercase text-[10px] tracking-wider"
              >
                <tr>
                  <th class="p-4">วันที่</th>
                  <th class="p-4">อุปกรณ์</th>
                  <th class="p-4">ผู้บริจาค</th>
                  <th class="p-4">สถานะ</th>
                  <th class="p-4 text-center">ข้อมูลติดต่อ</th>
                </tr>
              </thead>
              <tbody
                id="table-hardware"
                class="divide-y divide-white/5"
              ></tbody>
            </table>
          </div>
        </div>

        <div id="sec-settings" class="hidden space-y-6 animate-fade">
          <h2 class="text-2xl font-bold text-white">
            ตั้งค่าระบบ (Backend Config)
          </h2>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div class="glass-card p-8 rounded-2xl border-l-4 border-blue-500">
              <h3
                class="text-lg font-bold text-white mb-6 flex items-center gap-2"
              >
                <i class="fas fa-university text-blue-400"></i>
                ข้อมูลบัญชีรับเงิน
              </h3>
              <div class="space-y-4">
                <div>
                  <label class="block text-xs text-slate-500 mb-1"
                    >ชื่อธนาคาร</label
                  >
                  <input
                    type="text"
                    id="set-bankName"
                    class="w-full bg-slate-900 border border-white/10 rounded-lg p-3 text-white focus:border-blue-500 focus:outline-none"
                  />
                </div>
                <div>
                  <label class="block text-xs text-slate-500 mb-1"
                    >เลขที่บัญชี (จะแสดงที่หน้าโอนเงิน)</label
                  >
                  <input
                    type="text"
                    id="set-bankNum"
                    class="w-full bg-slate-900 border border-white/10 rounded-lg p-3 text-xl font-mono text-emerald-400 font-bold focus:border-blue-500 focus:outline-none"
                  />
                </div>
                <div>
                  <label class="block text-xs text-slate-500 mb-1"
                    >ชื่อเจ้าของบัญชี</label
                  >
                  <input
                    type="text"
                    id="set-accName"
                    class="w-full bg-slate-900 border border-white/10 rounded-lg p-3 text-white focus:border-blue-500 focus:outline-none"
                  />
                </div>
                <button
                  onclick="saveSettings()"
                  class="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-all mt-4"
                >
                  <i class="fas fa-save mr-2"></i> บันทึกการเปลี่ยนแปลง
                </button>
              </div>
            </div>

            <div>
              <h3 class="text-sm font-bold text-slate-400 mb-4">
                Preview (มุมมองผู้ใช้):
              </h3>
              <div
                class="glass-card p-6 rounded-2xl text-center max-w-sm mx-auto"
              >
                <div
                  class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center mx-auto mb-4"
                >
                  <i class="fas fa-university text-2xl text-white"></i>
                </div>
                <h4 id="prev-bankName" class="text-blue-400 font-bold">
                  Bank Name
                </h4>
                <h2
                  id="prev-bankNum"
                  class="text-3xl font-black text-white my-2 tracking-wider"
                >
                  000-0-000
                </h2>
                <p id="prev-accName" class="text-slate-400 text-sm">
                  Account Name
                </p>
              </div>
              <p class="text-[10px] text-slate-600 text-center mt-4">
                ข้อมูลนี้จะไปปรากฏที่หน้า donate.html ทันทีที่กดบันทึก
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      // --- Shared Database Logic ---
      const DB_KEY = "tech_donate_data";
      let db = {
        settings: {
          bankName: "กสิกรไทย",
          bankNum: "000-0-00000-0",
          accName: "Example Account",
        },
        logs: [],
        hardwareLogs: [],
      };

      function loadDB() {
        const saved = localStorage.getItem(DB_KEY);
        if (saved) db = JSON.parse(saved);
        else saveDB();
      }

      function saveDB() {
        localStorage.setItem(DB_KEY, JSON.stringify(db));
      }

      // --- Auth Guard ---
      function checkAuth() {
        // Simple session check (In real app, use tokens)
        if (!sessionStorage.getItem("admin_logged_in")) {
          Swal.fire({
            title: "Admin Access",
            input: "password",
            inputPlaceholder: "Enter Password",
            allowOutsideClick: false,
            background: "#0f172a",
            color: "#fff",
          }).then((result) => {
            // Password Example: admin1234
            if (result.value === "1234") {
              sessionStorage.setItem("admin_logged_in", "true");
              init();
            } else {
              window.location.href = "index.html";
            }
          });
        } else {
          init();
        }
      }

      // --- Core Functions ---
      function init() {
        loadDB();
        renderDashboard();
        renderSettings();
        renderDonations();
        renderHardware();
      }

      function showSection(id) {
        // Hide all
        ["dashboard", "donations", "hardware", "settings"].forEach((s) => {
          document.getElementById("sec-" + s).classList.add("hidden");
          document.getElementById("nav-" + s).classList.remove("active");
        });
        // Show selected
        document.getElementById("sec-" + id).classList.remove("hidden");
        document.getElementById("nav-" + id).classList.add("active");
      }

      function renderDashboard() {
        const total = db.logs.reduce((sum, l) => sum + l.amount, 0);
        document.getElementById("dash-total-money").innerText =
          `฿${total.toLocaleString()}`;
        document.getElementById("dash-pending").innerText = db.logs.length;
        document.getElementById("dash-hardware").innerText = (
          db.hardwareLogs || []
        ).length;

        // Generate Logs
        const combinedLogs = [
          ...db.logs.map((l) => ({ ...l, type: "money" })),
          ...db.hardwareLogs.map((h) => ({ ...h, type: "hw" })),
        ];
        combinedLogs.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

        document.getElementById("activity-logs").innerHTML = combinedLogs
          .slice(0, 5)
          .map(
            (l) => `
                <div class="flex items-center gap-3 border-l-2 ${l.type === "money" ? "border-emerald-500" : "border-purple-500"} pl-3 py-1">
                    <span class="text-xs text-slate-500">${l.date}</span>
                    <span class="text-slate-300">ได้รับ ${l.type === "money" ? "เงิน ฿" + l.amount.toLocaleString() : "อุปกรณ์ " + l.device} จาก ${l.name || l.donor}</span>
                </div>
            `,
          )
          .join("");
      }

      function renderDonations() {
        const tbody = document.getElementById("table-money");
        if (db.logs.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-slate-500">ยังไม่มีข้อมูล</td></tr>`;
          return;
        }
        tbody.innerHTML = db.logs
          .map(
            (log, index) => `
                <tr class="hover:bg-white/[0.02] transition-colors">
                    <td class="p-4 text-slate-500 text-xs">${log.date}</td>
                    <td class="p-4 font-bold text-white">${log.name}</td>
                    <td class="p-4 text-emerald-400 font-bold">฿${log.amount.toLocaleString()}</td>
                    <td class="p-4 text-center">
                        <button onclick="viewSlip(${index})" class="text-blue-400 hover:text-white px-3 py-1 bg-blue-500/10 rounded-lg text-xs">ดูสลิป</button>
                    </td>
                    <td class="p-4 text-center">
                        <button onclick="deleteLog('logs', ${index})" class="text-red-400 hover:text-red-200"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `,
          )
          .join("");
      }

      function renderHardware() {
        const tbody = document.getElementById("table-hardware");
        const hw = db.hardwareLogs || [];
        if (hw.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" class="p-8 text-center text-slate-500">ยังไม่มีข้อมูล</td></tr>`;
          return;
        }
        tbody.innerHTML = hw
          .map(
            (h, index) => `
                <tr class="hover:bg-white/[0.02]">
                    <td class="p-4 text-slate-500 text-xs">${h.date}</td>
                    <td class="p-4">
                        <div class="font-bold text-white">${h.device}</div>
                        <div class="text-[10px] text-slate-500">${h.brand || "-"}</div>
                    </td>
                    <td class="p-4 text-slate-300">${h.donor}</td>
                    <td class="p-4">
                        <select onchange="updateHWStatus(${index}, this.value)" class="bg-slate-900 border border-white/10 text-xs rounded px-2 py-1 outline-none">
                            <option value="pending" ${!h.status || h.status === "pending" ? "selected" : ""}>รอรับมอบ</option>
                            <option value="received" ${h.status === "received" ? "selected" : ""}>ได้รับแล้ว</option>
                        </select>
                    </td>
                    <td class="p-4 text-center text-xs text-slate-400">${h.contact}</td>
                </tr>
            `,
          )
          .join("");
      }

      function renderSettings() {
        // Fill Inputs
        document.getElementById("set-bankName").value = db.settings.bankName;
        document.getElementById("set-bankNum").value = db.settings.bankNum;
        document.getElementById("set-accName").value = db.settings.accName;

        // Fill Preview
        updatePreview();
      }

      // --- Action Functions ---

      function updatePreview() {
        document.getElementById("prev-bankName").innerText =
          document.getElementById("set-bankName").value;
        document.getElementById("prev-bankNum").innerText =
          document.getElementById("set-bankNum").value;
        document.getElementById("prev-accName").innerText =
          document.getElementById("set-accName").value;
      }

      // Real-time preview listener
      document.querySelectorAll("#sec-settings input").forEach((input) => {
        input.addEventListener("keyup", updatePreview);
      });

      function saveSettings() {
        db.settings.bankName = document.getElementById("set-bankName").value;
        db.settings.bankNum = document.getElementById("set-bankNum").value;
        db.settings.accName = document.getElementById("set-accName").value;
        saveDB();
        Swal.fire({
          icon: "success",
          title: "บันทึกเรียบร้อย",
          text: "หน้า Donate จะแสดงข้อมูลใหม่ทันที",
          background: "#0f172a",
          color: "#fff",
          timer: 1500,
          showConfirmButton: false,
        });
      }

      function viewSlip(index) {
        const img = db.logs[index].slipImg;
        if (!img)
          return Swal.fire({
            icon: "error",
            title: "ไม่พบรูปภาพ",
            background: "#0f172a",
          });
        Swal.fire({
          imageUrl: img,
          imageAlt: "Slip",
          background: "#0f172a",
          showConfirmButton: false,
          showCloseButton: true,
          width: 400,
        });
      }

      function deleteLog(type, index) {
        Swal.fire({
          title: "ยืนยันการลบ?",
          text: "ข้อมูลจะหายไปถาวร",
          icon: "warning",
          showCancelButton: true,
          background: "#0f172a",
          color: "#fff",
          confirmButtonColor: "#ef4444",
          cancelButtonColor: "#334155",
        }).then((result) => {
          if (result.isConfirmed) {
            if (type === "logs") db.logs.splice(index, 1);
            // else if (type === 'hardware') db.hardwareLogs.splice(index, 1);
            saveDB();
            init(); // Re-render
            Swal.fire({
              title: "ลบแล้ว!",
              icon: "success",
              timer: 1000,
              showConfirmButton: false,
              background: "#0f172a",
            });
          }
        });
      }

      function updateHWStatus(index, val) {
        if (!db.hardwareLogs) db.hardwareLogs = [];
        db.hardwareLogs[index].status = val;
        saveDB();
      }

      function clearData(type) {
        Swal.fire({
          title: "ล้างข้อมูลทั้งหมด?",
          text: "ระวัง! ข้อมูลทั้งหมดจะหายไป",
          icon: "warning",
          showCancelButton: true,
          background: "#0f172a",
          color: "#fff",
          confirmButtonText: "ใช่, ลบทั้งหมด",
        }).then((res) => {
          if (res.isConfirmed) {
            db[type] = [];
            saveDB();
            init();
          }
        });
      }

      // Start
      checkAuth();
    </script>
  </body>
</html>
